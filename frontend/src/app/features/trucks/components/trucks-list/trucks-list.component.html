<div class="trucks-layout">
  <app-sidebar [collapsed]="sidebarCollapsed" (toggleSidebar)="toggleSidebar()"></app-sidebar>
  <div class="main-content" [class.sidebar-collapsed]="sidebarCollapsed">
    <header class="dashboard-header">
      <div class="header-left">
        <h1>{{ 'SIDEBAR.MENU.TRUCKS_CONTROL' | translate }}</h1>
      </div>
      <div class="header-right">
        <span class="welcome-text">{{ 'DASHBOARD.WELCOME' | translate }}, Usuario</span>
        <app-language-selector></app-language-selector>
        <button class="logout-btn" title="{{ 'SIDEBAR.PROFILE.LOGOUT' | translate }}" [attr.aria-label]="'SIDEBAR.PROFILE.LOGOUT' | translate">
          <app-logout-icon [size]="'20'" [stroke]="'#fff'"></app-logout-icon>
        </button>
      </div>
    </header>
    <main class="trucks-main">
      <app-card>
        <div class="header-actions">
          <!-- <h2 class="card-title">{{ 'TRUCKS.LIST.TITLE' | translate }}</h2> -->
          <app-button #btn (click)="createNewTruck()" variant="primary" (mouseenter)="onNewButtonMouseEnter()" (mouseleave)="onNewButtonMouseLeave()">
            <app-plus-icon icon [size]="'16'" [stroke]="newButtonIconColor" style="margin-right: 8px;"></app-plus-icon>
            {{ 'TRUCKS.LIST.CREATE_NEW' | translate }}
          </app-button>
        </div>

        <!-- Filtros -->
        <div class="filters-section">
          <div style="display: flex; align-items: center; gap: 0.5rem;">
            <h3>
              <svg style="vertical-align: middle; margin-right: 8px;" width="22" height="22" fill="none" stroke="#fff" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
                <path d="M3 4a1 1 0 0 1 1-1h16a1 1 0 0 1 1 1v2.382a1 1 0 0 1-.293.707l-5.414 5.414A2 2 0 0 0 14 14.414V19a1 1 0 0 1-1.447.894l-2-1A1 1 0 0 1 10 18v-3.586a2 2 0 0 0-.586-1.414L4 7.09A1 1 0 0 1 3.707 6.382V4Z" />
              </svg>
              {{ 'TRUCKS.LIST.FILTERS' | translate }}
            </h3>
            <button (click)="toggleFiltersCollapse()" style="background: none; border: none; cursor: pointer; padding: 0; margin-left: 0.5rem;">
              <svg *ngIf="filtersCollapsed" width="20" height="20" fill="none" stroke="#545386" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>
              <svg *ngIf="!filtersCollapsed" width="20" height="20" fill="none" stroke="#545386" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 15 12 9 18 15"/></svg>
            </button>
          </div>
          <div *ngIf="!filtersCollapsed">
            <form [formGroup]="filterForm" class="filters-form">
              <div class="filters-grid">
                <app-input [control]="idEmpresaFilterControl" [label]="'FORMS.TRUCK_CONTROL.ID_EMPRESA' | translate"></app-input>
                <app-input [control]="idWarehouseFilterControl" [label]="'FORMS.TRUCK_CONTROL.ID_WAREHOUSE' | translate"></app-input>
                <app-input [control]="carrierFilterControl" [label]="'FORMS.TRUCK_CONTROL.CARRIER' | translate"></app-input>
                <app-input [control]="customerFacilityFilterControl" [label]="'FORMS.TRUCK_CONTROL.CUSTOMER_FACILITY' | translate"></app-input>
                <app-input [control]="estatusFilterControl" [label]="'FORMS.TRUCK_CONTROL.ESTATUS' | translate"></app-input>
                <app-input [control]="shipDateFromFilterControl" [label]="'TRUCKS.LIST.SHIP_DATE_FROM' | translate" type="date"></app-input>
                <app-input [control]="shipDateToFilterControl" [label]="'TRUCKS.LIST.SHIP_DATE_TO' | translate" type="date"></app-input>
                <app-input [control]="delivDateFromFilterControl" [label]="'TRUCKS.LIST.DELIV_DATE_FROM' | translate" type="date"></app-input>
                <app-input [control]="delivDateToFilterControl" [label]="'TRUCKS.LIST.DELIV_DATE_TO' | translate" type="date"></app-input>
              </div>
              <div class="filter-actions">
                <app-button #btnClear type="button" (click)="clearFilters()" variant="primary">
                  <app-x-mark-icon icon [size]="'16'" [stroke]="'#545386'" style="margin-right: 8px;"></app-x-mark-icon>
                  {{ 'COMMON.CLEAR' | translate }}
                </app-button>
              </div>
            </form>
          </div>
        </div>

        <!-- Tabla de resultados -->
        <div class="results-section">
          <div class="results-header">
            <span class="results-count">
              {{ 'TRUCKS.LIST.SHOWING' | translate }} {{ (currentPage - 1) * itemsPerPage + 1 }} - {{ getMaxItems() }} {{ 'TRUCKS.LIST.OF' | translate }} {{ totalItems }} {{ 'TRUCKS.LIST.RECORDS' | translate }}
            </span>
          </div>

          <div class="table-container" *ngIf="!loading; else loadingTemplate">
            <table class="trucks-table" *ngIf="paginatedTrucks.length > 0; else noDataTemplate">
              <thead>
                <tr>
                  <th>{{ 'FORMS.TRUCK_CONTROL.ID_EMPRESA' | translate }}</th>
                  <th>{{ 'FORMS.TRUCK_CONTROL.ID_WAREHOUSE' | translate }}</th>
                  <th>{{ 'FORMS.TRUCK_CONTROL.SHIPDATE' | translate }}</th>
                  <th>{{ 'FORMS.TRUCK_CONTROL.CARRIER' | translate }}</th>
                  <th>{{ 'FORMS.TRUCK_CONTROL.CUSTOMER_FACILITY' | translate }}</th>
                  <th>{{ 'FORMS.TRUCK_CONTROL.ESTATUS' | translate }}</th>
                  <th>{{ 'COMMON.ACTIONS' | translate }}</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let truck of paginatedTrucks">
                  <td>{{ truck.id_empresa }}</td>
                  <td>{{ truck.id_warehouse }}</td>
                  <td>{{ truck.ship_date | date:'shortDate' }}</td>
                  <td>{{ truck.carrier }}</td>
                  <td>{{ truck.customer_facility }}</td>
                  <td>
                    <span class="status-badge" [class]="'status-' + (truck.estatus?.toString() || '').toLowerCase()">
                      {{ truck.estatus }}
                    </span>
                  </td>
                  <td class="actions-cell">
                    <div class="action-buttons">
                      <button class="btn-icon btn-view" (click)="viewTruck(truck)" title="{{ 'COMMON.VIEW' | translate }}">
                        <i class="fas fa-eye"></i>
                      </button>
                      <button class="btn-icon btn-edit" (click)="editTruck(truck)" title="{{ 'COMMON.EDIT' | translate }}">
                        <i class="fas fa-edit"></i>
                      </button>
                      <button class="btn-icon btn-delete" (click)="deleteTruck(truck)" title="{{ 'COMMON.DELETE' | translate }}">
                        <i class="fas fa-trash"></i>
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- PaginaciÃ³n -->
          <div class="pagination" *ngIf="totalPages > 1">
            <button 
              class="btn-page" 
              [disabled]="currentPage === 1"
              (click)="changePage(currentPage - 1)">
              {{ 'COMMON.PREVIOUS' | translate }}
            </button>
            
            <div class="page-numbers">
              <button 
                *ngFor="let page of pages"
                class="btn-page" 
                [class.active]="page === currentPage"
                (click)="changePage(page)">
                {{ page }}
              </button>
            </div>
            
            <button 
              class="btn-page" 
              [disabled]="currentPage === totalPages"
              (click)="changePage(currentPage + 1)">
              {{ 'COMMON.NEXT' | translate }}
            </button>
          </div>
        </div>
      </app-card>
    </main>
  </div>
</div>

<!-- Templates -->
<ng-template #loadingTemplate>
  <div class="loading-container">
    <div class="spinner"></div>
    <p>{{ 'COMMON.LOADING' | translate }}</p>
  </div>
</ng-template>

<ng-template #noDataTemplate>
  <div class="no-data">
    <p>{{ 'TRUCKS.LIST.NO_DATA' | translate }}</p>
  </div>
</ng-template> 